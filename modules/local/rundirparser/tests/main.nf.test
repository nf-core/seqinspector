nextflow_process {

    name "Test Process RUNDIRPARSER"
    script "../main.nf"
    process "RUNDIRPARSER"
    config "./nextflow.config"

    test("Should run without failures") {


        when {
            process {
                """
                input[0] = file("$moduleDir/tests/data/test_rundir")
                """
            }
        }

        then {
            assert process.success
            assert snapshot(process.out.yml).match()
            assert process.out.versions.size() == 1
        }


    }

    test("Should create correct yaml structure") {

        when {
            process {
                """
                input[0] = file("$moduleDir/tests/data/test_rundir")
                """
            }
        }

        then {
            def yamlcontent = path(process.out.yml[0]).yaml

            assert yamlcontent.custom_data.my_data_type.data."Instrument type" == "NovaSeqXPlus"
            assert snapshot(process.out.yml).match()
        }

    }

}
